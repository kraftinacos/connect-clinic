<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Elixir">
    <meta name="theme-color" content="#0F172A">
    <title>Elixir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; box-sizing: border-box; }
        html, body { max-width: 100vw; overflow-x: hidden; margin: 0; padding: 0; background: #0F172A; color: white; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 100px); }
        .btn-huge { min-height: 72px; border-radius: 24px; font-size: 28px; font-weight: 700; padding: 32px; }
        .btn-primary { background: #14B8A6; color: white; box-shadow: 0 4px 20px rgba(20,184,166,0.4); }
        .btn-primary:active { transform: scale(0.98); background: #0D9488; }
        .btn-secondary { background: #1E2937; color: white; border: 3px solid #334155; }
        .btn-secondary:active { transform: scale(0.98); background: #0F172A; }
        .card { background: #1E2937; border-radius: 28px; padding: 32px; }
        .tab-active { color: #14B8A6; }
        .tab-inactive { color: #64748B; }
        .time-slot { min-height: 72px; border-radius: 20px; background: #1E2937; border: 3px solid #334155; font-size: 24px; font-weight: 600; }
        .time-slot.selected { background: #14B8A6; border-color: #14B8A6; color: white; }
        .day-pill { min-width: 72px; min-height: 96px; border-radius: 24px; font-size: 20px; }
        .day-pill.today { background: #14B8A6; color: white; box-shadow: 0 4px 20px rgba(20,184,166,0.4); }
        .day-pill.other { background: #1E2937; color: #94A3B8; border: 3px solid #334155; }
        #install-banner { position: fixed; bottom: 120px; left: 20px; right: 20px; background: #14B8A6; border-radius: 28px; padding: 28px; z-index: 1000; display: none; }
        #install-banner.show { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .hidden { display: none !important; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: #1E2937; border-radius: 32px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 32px; }
        input, select, textarea { background: #0F172A; border: 3px solid #334155; border-radius: 20px; color: white; min-height: 72px; padding: 0 28px; font-size: 24px; width: 100%; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #14B8A6; }
        .stat-num { font-size: 48px; font-weight: 800; }
        .profile-avatar { width: 56px; height: 56px; border-radius: 50%; background: #14B8A6; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; }
        .profile-option { padding: 24px; border-radius: 20px; background: #0F172A; margin-bottom: 16px; display: flex; align-items: center; gap: 20px; }
        .profile-option.active { border: 3px solid #14B8A6; }
    </style>
</head>
<body class="safe-top safe-bottom">
    <!-- Install Banner -->
    <div id="install-banner">
        <div class="flex items-center justify-between text-white">
            <div>
                <p class="font-bold text-2xl">Add to Home Screen</p>
                <p class="text-lg opacity-90 mt-2">Launch Elixir as native app</p>
            </div>
            <button onclick="addToHomeScreen()" class="bg-white text-slate-900 px-8 py-5 rounded-3xl font-bold text-xl">ADD</button>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-slate-900 px-6 py-6 flex items-center justify-between sticky top-0 z-50">
        <div class="flex items-center gap-4">
            <div class="w-16 h-16 bg-teal-500 rounded-3xl flex items-center justify-center text-white font-bold text-3xl">E</div>
            <span class="font-bold text-3xl">Elixir</span>
        </div>
        <button onclick="openProfileModal()" class="profile-avatar" id="current-profile-avatar">DR</button>
    </header>

    <!-- Week Range -->
    <div class="px-6 py-4 text-center">
        <span class="text-slate-400 text-xl" id="week-range">Mon 16 Feb - Sun 22 Feb 2026</span>
    </div>

    <!-- Stats Cards -->
    <div class="px-6 py-4 grid grid-cols-3 gap-4">
        <div class="card text-center">
            <div class="stat-num text-teal-400" id="stat-today">0</div>
            <div class="text-lg text-slate-400 mt-2">Today</div>
        </div>
        <div class="card text-center">
            <div class="stat-num text-teal-400" id="stat-tasks">0</div>
            <div class="text-lg text-slate-400 mt-2">Tasks</div>
        </div>
        <div class="card text-center">
            <div class="stat-num text-teal-400" id="stat-recalls">0</div>
            <div class="text-lg text-slate-400 mt-2">Recalls</div>
        </div>
    </div>

    <!-- Week Selector -->
    <div class="px-6 py-4 overflow-x-auto">
        <div class="flex gap-3 min-w-max">
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Mon', 16)">
                <span class="text-base">Mon</span>
                <span class="font-bold text-2xl">16</span>
            </button>
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Tue', 17)">
                <span class="text-base">Tue</span>
                <span class="font-bold text-2xl">17</span>
            </button>
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Wed', 18)">
                <span class="text-base">Wed</span>
                <span class="font-bold text-2xl">18</span>
            </button>
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Thu', 19)">
                <span class="text-base">Thu</span>
                <span class="font-bold text-2xl">19</span>
            </button>
            <button class="day-pill today flex flex-col items-center justify-center" onclick="selectDay('Fri', 20)">
                <span class="text-base">Fri</span>
                <span class="font-bold text-2xl">20</span>
            </button>
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Sat', 21)">
                <span class="text-base">Sat</span>
                <span class="font-bold text-2xl">21</span>
            </button>
            <button class="day-pill other flex flex-col items-center justify-center" onclick="selectDay('Sun', 22)">
                <span class="text-base">Sun</span>
                <span class="font-bold text-2xl">22</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="px-6 pb-40">
        <!-- Schedule View -->
        <div id="view-schedule" class="view-section">
            <button onclick="openBookingModal()" class="btn-huge btn-primary w-full mb-6 flex items-center justify-center gap-3">
                <span class="text-3xl">+</span> Book
            </button>
            
            <div class="card text-center" id="empty-state">
                <div class="text-8xl mb-6">üìÖ</div>
                <h3 class="font-bold text-3xl mb-3">No appointments</h3>
                <p class="text-slate-400 text-xl">Tap Book to add</p>
            </div>

            <div id="appointments-list" class="space-y-4 hidden">
                <!-- Appointments injected here -->
            </div>
        </div>

        <!-- Day List View -->
        <div id="view-daylist" class="view-section hidden">
            <div class="card text-center py-12">
                <div class="text-8xl mb-6">üìã</div>
                <h3 class="font-bold text-3xl mb-3">Day List</h3>
                <p class="text-slate-400 text-xl">Queue appears here</p>
            </div>
        </div>

        <!-- Patients View -->
        <div id="view-patients" class="view-section hidden">
            <input type="text" id="patient-search" placeholder="üîç Search" class="mb-6" oninput="searchPatients(this.value)">
            <div id="patients-list" class="space-y-4">
                <button class="btn-huge btn-secondary w-full text-left" onclick="selectPatient('John Smith')">John Smith</button>
                <button class="btn-huge btn-secondary w-full text-left" onclick="selectPatient('Sarah Lee')">Sarah Lee</button>
                <button class="btn-huge btn-secondary w-full text-left" onclick="selectPatient('Mike Chen')">Mike Chen</button>
            </div>
        </div>

        <!-- Office View -->
        <div id="view-office" class="view-section hidden">
            <div class="card text-center py-12">
                <div class="text-8xl mb-6">üè¢</div>
                <h3 class="font-bold text-3xl mb-3">Office</h3>
                <p class="text-slate-400 text-xl">Management tools</p>
            </div>
        </div>

        <!-- Tasks View -->
        <div id="view-tasks" class="view-section hidden">
            <button onclick="addTask()" class="btn-huge btn-primary w-full mb-6">+ Task</button>
            <div id="tasks-list" class="space-y-4">
                <!-- Tasks injected here -->
            </div>
        </div>
    </main>

    <!-- Booking Modal -->
    <div id="booking-modal" class="modal">
        <div class="modal-content">
            <h2 class="font-bold text-4xl mb-8">New Booking</h2>
            
            <label class="block text-slate-400 mb-3 text-xl">Patient</label>
            <input type="text" id="booking-patient" placeholder="Name" class="mb-6">
            
            <label class="block text-slate-400 mb-3 text-xl">Date</label>
            <input type="date" id="booking-date" class="mb-6">
            
            <label class="block text-slate-400 mb-3 text-xl">Time</label>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '08:00')">8:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '09:00')">9:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '10:00')">10:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '11:00')">11:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '14:00')">14:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '15:00')">15:00</button>
                <button class="time-slot flex items-center justify-center" onclick="selectTime(this, '16:00')">16:00</button>
            </div>
            
            <div class="flex gap-4">
                <button onclick="closeBookingModal()" class="btn-huge btn-secondary flex-1">Cancel</button>
                <button onclick="saveAppointment()" class="btn-huge btn-primary flex-1">Save</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <h2 class="font-bold text-4xl mb-8">Switch Profile</h2>
            
            <button class="profile-option active" onclick="switchProfile('dr-smith', 'DS', 'Dr Smith')" id="profile-dr-smith">
                <div class="w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center text-2xl font-bold">DS</div>
                <div class="text-left">
                    <div class="font-bold text-2xl">Dr Smith</div>
                    <div class="text-slate-400 text-lg">Doctor</div>
                </div>
            </button>
            
            <button class="profile-option" onclick="switchProfile('dr-lee', 'DL', 'Dr Lee')" id="profile-dr-lee">
                <div class="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center text-2xl font-bold">DL</div>
                <div class="text-left">
                    <div class="font-bold text-2xl">Dr Lee</div>
                    <div class="text-slate-400 text-lg">Doctor</div>
                </div>
            </button>
            
            <button class="profile-option" onclick="switchProfile('nurse-kim', 'NK', 'Nurse Kim')" id="profile-nurse-kim">
                <div class="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center text-2xl font-bold">NK</div>
                <div class="text-left">
                    <div class="font-bold text-2xl">Nurse Kim</div>
                    <div class="text-slate-400 text-lg">Nurse</div>
                </div>
            </button>
            
            <button class="profile-option" onclick="switchProfile('admin-taylor', 'AT', 'Admin Taylor')" id="profile-admin-taylor">
                <div class="w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center text-2xl font-bold">AT</div>
                <div class="text-left">
                    <div class="font-bold text-2xl">Admin Taylor</div>
                    <div class="text-slate-400 text-lg">Administrator</div>
                </div>
            </button>
            
            <button onclick="closeProfileModal()" class="btn-huge btn-secondary w-full mt-4">Close</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
        <div class="modal-content text-center">
            <div class="text-8xl mb-6">‚úÖ</div>
            <h2 class="font-bold text-4xl mb-4">Saved!</h2>
            <p class="text-slate-400 text-2xl mb-8" id="success-message">Appointment booked</p>
            <button onclick="closeSuccessModal()" class="btn-huge btn-primary w-full">Done</button>
        </div>
    </div>

    <!-- Patient Selected Modal -->
    <div id="patient-modal" class="modal">
        <div class="modal-content">
            <h2 class="font-bold text-4xl mb-6" id="patient-name">Patient</h2>
            <div class="space-y-4">
                <button class="btn-huge btn-primary w-full">üìã Records</button>
                <button class="btn-huge btn-primary w-full">üíä Prescribe</button>
                <button class="btn-huge btn-secondary w-full" onclick="closePatientModal()">Back</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-slate-900 border-t-4 border-slate-800 px-4 py-4 safe-bottom z-50">
        <div class="flex justify-around items-center">
            <button onclick="switchTab('schedule')" class="tab-btn flex flex-col items-center gap-2 p-3 tab-active" data-tab="schedule">
                <span class="text-4xl">üìÖ</span>
                <span class="text-base font-bold">Book</span>
            </button>
            <button onclick="switchTab('daylist')" class="tab-btn flex flex-col items-center gap-2 p-3 tab-inactive" data-tab="daylist">
                <span class="text-4xl">üìã</span>
                <span class="text-base font-bold">List</span>
            </button>
            <button onclick="switchTab('patients')" class="tab-btn flex flex-col items-center gap-2 p-3 tab-inactive" data-tab="patients">
                <span class="text-4xl">üë§</span>
                <span class="text-base font-bold">Patients</span>
            </button>
            <button onclick="switchTab('office')" class="tab-btn flex flex-col items-center gap-2 p-3 tab-inactive" data-tab="office">
                <span class="text-4xl">üè¢</span>
                <span class="text-base font-bold">Office</span>
            </button>
            <button onclick="switchTab('tasks')" class="tab-btn flex flex-col items-center gap-2 p-3 tab-inactive" data-tab="tasks">
                <span class="text-4xl">‚úì</span>
                <span class="text-base font-bold">Tasks</span>
            </button>
        </div>
    </nav>

    <script>
        // State
        let selectedTime = null;
        let currentProfile = localStorage.getItem('elixir_current_profile') || 'dr-smith';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateProfileDisplay();
            loadAppointments();
            loadTasks();
            updateStats();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('booking-date').value = today;
            
            if (!window.navigator.standalone && !window.matchMedia('(display-mode: standalone)').matches) {
                setTimeout(() => {
                    document.getElementById('install-banner').classList.add('show');
                }, 2000);
            }
        });
        
        // Profile Functions
        function openProfileModal() {
            document.getElementById('profile-modal').classList.add('show');
            document.querySelectorAll('.profile-option').forEach(el => el.classList.remove('active'));
            document.getElementById('profile-' + currentProfile)?.classList.add('active');
        }
        
        function closeProfileModal() {
            document.getElementById('profile-modal').classList.remove('show');
        }
        
        function switchProfile(profileId, initials, name) {
            currentProfile = profileId;
            localStorage.setItem('elixir_current_profile', profileId);
            updateProfileDisplay();
            loadAppointments();
            loadTasks();
            updateStats();
            closeProfileModal();
        }
        
        function updateProfileDisplay() {
            const profiles = {
                'dr-smith': 'DS',
                'dr-lee': 'DL',
                'nurse-kim': 'NK',
                'admin-taylor': 'AT'
            };
            document.getElementById('current-profile-avatar').textContent = profiles[currentProfile] || 'DR';
        }
        
        function getStorageKey(key) {
            return `elixir_${currentProfile}_${key}`;
        }
        
        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + tabName).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.classList.remove('tab-inactive');
                    btn.classList.add('tab-active');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                }
            });
        }
        
        function selectDay(day, date) {
            document.querySelectorAll('.day-pill').forEach(pill => {
                pill.classList.remove('today');
                pill.classList.add('other');
            });
            event.currentTarget.classList.remove('other');
            event.currentTarget.classList.add('today');
            loadAppointments();
        }
        
        // Booking
        function openBookingModal() {
            document.getElementById('booking-modal').classList.add('show');
        }
        
        function closeBookingModal() {
            document.getElementById('booking-modal').classList.remove('show');
            selectedTime = null;
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            document.getElementById('booking-patient').value = '';
        }
        
        function selectTime(element, time) {
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('selected'));
            element.classList.add('selected');
            selectedTime = time;
        }
        
        function saveAppointment() {
            const patient = document.getElementById('booking-patient').value;
            const date = document.getElementById('booking-date').value;
            
            if (!patient || !selectedTime) {
                alert('Enter name and time');
                return;
            }
            
            const appointment = {
                id: Date.now(),
                patient: patient,
                date: date,
                time: selectedTime,
                created: new Date().toISOString()
            };
            
            let appointments = JSON.parse(localStorage.getItem(getStorageKey('appointments')) || '[]');
            appointments.push(appointment);
            localStorage.setItem(getStorageKey('appointments'), JSON.stringify(appointments));
            
            closeBookingModal();
            document.getElementById('success-message').textContent = `Booked ${patient} at ${selectedTime}`;
            document.getElementById('success-modal').classList.add('show');
            loadAppointments();
            updateStats();
        }
        
        function closeSuccessModal() {
            document.getElementById('success-modal').classList.remove('show');
        }
        
        // Appointments
        function loadAppointments() {
            const appointments = JSON.parse(localStorage.getItem(getStorageKey('appointments')) || '[]');
            const list = document.getElementById('appointments-list');
            const emptyState = document.getElementById('empty-state');
            const today = new Date().toISOString().split('T')[0];
            const todays = appointments.filter(a => a.date === today);
            
            if (todays.length === 0) {
                list.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            list.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            list.innerHTML = todays.map(a => `
                <div class="card flex items-center justify-between">
                    <div>
                        <div class="font-bold text-3xl">${a.patient}</div>
                        <div class="text-teal-400 text-2xl mt-1">${a.time}</div>
                    </div>
                    <button onclick="deleteAppointment(${a.id})" class="text-red-400 p-4 text-3xl">üóë</button>
                </div>
            `).join('');
        }
        
        function deleteAppointment(id) {
            if (!confirm('Delete?')) return;
            let appointments = JSON.parse(localStorage.getItem(getStorageKey('appointments')) || '[]');
            appointments = appointments.filter(a => a.id !== id);
            localStorage.setItem(getStorageKey('appointments'), JSON.stringify(appointments));
            loadAppointments();
            updateStats();
        }
        
        // Tasks
        function addTask() {
            const task = prompt('Task:');
            if (!task) return;
            
            let tasks = JSON.parse(localStorage.getItem(getStorageKey('tasks')) || '[]');
            tasks.push({ id: Date.now(), text: task, done: false });
            localStorage.setItem(getStorageKey('tasks'), JSON.stringify(tasks));
            loadTasks();
            updateStats();
        }
        
        function loadTasks() {
            const tasks = JSON.parse(localStorage.getItem(getStorageKey('tasks')) || '[]');
            const list = document.getElementById('tasks-list');
            
            if (tasks.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 py-8 text-2xl">No tasks</div>';
                return;
            }
            
            list.innerHTML = tasks.map(t => `
                <div class="card flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button onclick="toggleTask(${t.id})" class="text-4xl">${t.done ? '‚úÖ' : '‚≠ï'}</button>
                        <span class="text-2xl ${t.done ? 'line-through text-slate-500' : ''}">${t.text}</span>
                    </div>
                    <button onclick="deleteTask(${t.id})" class="text-red-400 p-4 text-3xl">üóë</button>
                </div>
            `).join('');
        }
        
        function toggleTask(id) {
            let tasks = JSON.parse(localStorage.getItem(getStorageKey('tasks')) || '[]');
            tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
            localStorage.setItem(getStorageKey('tasks'), JSON.stringify(tasks));
            loadTasks();
            updateStats();
        }
        
        function deleteTask(id) {
            let tasks = JSON.parse(localStorage.getItem(getStorageKey('tasks')) || '[]');
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem(getStorageKey('tasks'), JSON.stringify(tasks));
            loadTasks();
            updateStats();
        }
        
        // Patients
        function searchPatients(query) {
            const list = document.getElementById('patients-list');
            const patients = ['John Smith', 'Sarah Lee', 'Mike Chen', 'Emma Wilson', 'David Park'];
            const filtered = patients.filter(p => p.toLowerCase().includes(query.toLowerCase()));
            
            list.innerHTML = filtered.map(p => `
                <button class="btn-huge btn-secondary w-full text-left" onclick="selectPatient('${p}')">${p}</button>
            `).join('');
        }
        
        function selectPatient(name) {
            document.getElementById('patient-name').textContent = name;
            document.getElementById('patient-modal').classList.add('show');
        }
        
        function closePatientModal() {
            document.getElementById('patient-modal').classList.remove('show');
        }
        
        // Stats
        function updateStats() {
            const appointments = JSON.parse(localStorage.getItem(getStorageKey('appointments')) || '[]');
            const tasks = JSON.parse(localStorage.getItem(getStorageKey('tasks')) || '[]');
            const today = new Date().toISOString().split('T')[0];
            
            document.getElementById('stat-today').textContent = appointments.filter(a => a.date === today).length;
            document.getElementById('stat-tasks').textContent = tasks.filter(t => !t.done).length;
            document.getElementById('stat-recalls').textContent = '0';
        }
        
        // Install
        function addToHomeScreen() {
            if (navigator.share) {
                navigator.share({ title: 'Elixir', url: window.location.href });
            } else {
                alert('Tap Share ‚Üí Add to Home Screen');
            }
        }
        
        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                self.addEventListener('install', e => self.skipWaitWaiting());
                self.addEventListener('activate', e => e.waitUntil(clients.claim()));
                self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => new Response('Offline'))));
            `)).catch(() => {});
        }
    </script>
</body>
</html>